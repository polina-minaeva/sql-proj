# sql-proj
Анализ базы данных по авиаперевозкам, получение данных по самолетам, маршрутам, пассажирам, местам в самолетах, стоимости билетов и бронирования

Я решала несколько задач:
1. Вывела названия самолётов, которые имеют менее 50 посадочных мест. Для присоединения таблицы использовала join, группировала данные по самолетам с помощью group by, выводила только данные с менее 50 посадочных мест с помощью having count(s.seat_no) < 50.
2. Вывела процентное изменение ежемесячной суммы бронирования билетов, округленной до сотых. Сгруппировала значения по месяцам с помощью date_trunc('month', book_date), узнала сумму бронирования для каждого месяца с помощью оконной функции sum(total_amount) over (partition by months), использовала coalesce для замены null на исходное значение, обозначенное как 100%, узнала процентное изменение по сравнению с предыдущим значением с помощью функции lag, округлила значение с помощью round.
3. Вывела названия самолётов без бизнес-класса. Использовала в решении функцию array_agg для превращения данных в массив, оператор join для присоединения таблицы, оператор array_position для отбора данных, в которых нет слова Business: having array_position(conditions, 'Business') is null.
4. Вывела накопительный итог количества мест в самолётах по каждому аэропорту на каждый день (нужно было учесть только те самолеты, которые летали пустыми и только те дни, когда из одного аэропорта вылетело более одного такого самолёта). Отобрала пустые места посредством присоединения таблиц через join и с помощью конструкций: is null, is not null. Посчитала количество перелетов для самолетов в день с помощью оконной функции count(flight_id) over (partition by days, departure_airport) и отобрала только дни, когда из аэропорта вылетало несколько самолетов с помощью конструкции where count > 1. Накопительный итог находила с помощью оконной функции sum(chislo_pustikh_mest) over (partition by days, departure_airport order by actual_departure), chislo_pustikh_mest) as nacop_itog.
5. Нашла процентное соотношение перелётов по маршрутам от общего количества перелётов. Использовала в решении оконную функцию. Посчитала количество перелетов для каждого маршрута так: count(flight_id) over (partition by departure_airport, arrival_airport) * 100. И общее колисество перелетов:select count(flight_no).
6. Вывела количество пассажиров по каждому коду сотового оператора. Выделила нужные нам цифры из номера с помощью функции substring: substring(telephone from 3 for 3). Вывела из json нужные нам данные с помощью оператора ->>: select passenger_id, contact_data ->> 'phone'.
7. Классифицировала финансовые обороты (сумму стоимости билетов) по маршрутам и вывела в результат количество маршрутов в каждом полученном классе. Поставила условие с помощью CASE и классифицировала маршруты на 'low', 'high', 'middle'.
8. Вычислила медиану стоимости билетов, медиану стоимости бронирования и отношение медианы бронирования к медиане стоимости билетов, результат округлила до сотых. Использовала функцию percentile_cont(0.5) WITHIN GROUP для нахождения медиан.
9. Нашла значение минимальной стоимости одного километра полёта для пассажира. Для поиска расстояния использовала функцию ll_to_earth и оперировала кординатами аэропортов. Минимальную стоимость находила посредством деления стоимости билетов на найденное расстояние. 
